<!DOCTYPE html>
<html>

<head>
  <title>LPC - Fire/EMS Dashboard</title>
  <meta charset="utf-8">
  <meta name="description"
    content="Lines Roleplay Police CAD. Built to facilitate the needs of roleplay police and civilians." />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Codeply">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://kit.fontawesome.com/e048807041.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/static/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap.min.css" />
  <link rel="stylesheet" href="/static/css/animate.min.css" />
  <link rel="stylesheet" href="/static/css/ionicons.min.css" />
  <link rel="stylesheet" href="/static/css/tail.select-dark.min.css" />
  <link rel="stylesheet" href="/static/css/awesomplete.css" />
  <link rel="stylesheet" href="static/css/style.css">
  <link rel="stylesheet" href="/static/css/styles.css" />
  <link rel="shortcut icon" type="image/ico" href="static/images/favicon.ico">
  <script src="https://code.iconify.design/1/1.0.3/iconify.min.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script type="module" src="https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule="" src="https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.js"></script>
  <!-- To hide google translate header bar on each page -->
  <style type='text/css'> iframe.goog-te-banner-frame{ display: none !important;}</style>
  <style type='text/css'> body {position: static !important; top:0px !important;}</style>
  <% include ad-header %>
</head>
<body>

  <div class="wrapper d-flex align-items-stretch">
    <nav id="sidebar" style="z-index: 9;">
      <div class="img bg-wrap text-center py-4" style="background-image: linear-gradient(rgba(0,0,0,.4),rgba(0,0,0,.4)),url(/static/images/fire-ems-corner-bg.jpg);">
        <div class="user-logo">
          <a data-toggle="modal" href="#accountModal" onclick="fillAccountDetails()">
            <div class="img profile-picture"></div>
          </a>
          <h3>
            <%=user.user.username%>
          </h3>
          <h5>
            <%=user.user.callSign%>
          </h5>
          <h5>Logged in as: Fire/EMS</h5>
        </div>
      </div>
      <ul class="list-unstyled components mb-5">
        <li>
          <a href="/"><span class="fa fa-home mr-3"></span> <img style="display: inline; margin-top: -9px; vertical-align: text-top;" src="/static/images/favicon-32x32.png"></img> Lines Police CAD</a>
        </li>
        <li class="background-color-222">
          <a type="button" data-toggle="collapse" data-target="#toggleSearch" aria-expanded="true"
            aria-controls="toggleSearch" onclick="toggleCaret()"> Search <i class="fas fa-caret-right pull-right rotate"
              style="margin-top: 0.3em;"></i></a>
        </li>
        <div class="collapse in" id="toggleSearch">
          <li>
            <a data-toggle="modal" href="#searchMedicalRecords"><span class="fa fa-database ml-3 mr-3"></span> Medical
              Database</a>
          </li>
          <li>
            <a data-toggle="modal" href="#newCivModal"><span class="fa fa-id-card ml-3 mr-3"></span> Add New Persona</a>
          </li>
          <li>
            <a data-toggle="modal" href="#newVehicleModal"><span class="fa fa-car ml-3 mr-3"></span> Add New Vehicle</a>
          </li>
        </div>
        <li class="background-color-222">
          <a type="button" data-toggle="collapse" data-target="#toggleUtilities" aria-expanded="false"
            aria-controls="toggleUtilities" onclick="toggleCaret()"> Utilities <i
              class="fas fa-caret-right pull-right rotate" style="margin-top: 0.3em;"></i></a>
        </li>
        <div class="collapse in" id="toggleUtilities">
          <li>
            <a data-toggle="modal" href="#10codesModal"><span class="fas fa-list-alt ml-3 mr-3"></span> 10-Codes</a>
          </li>
          <li>
          <li>
            <a data-toggle="modal" href="#notepadModal"><span class="fas fa-clipboard ml-3 mr-3"></span> Notepad</a>
          </li>
          <li>
            <a href="/map-interactive"><span class="fa fa-map ml-3 mr-3"></span> Map <i
                class="fas fa-external-link-alt"></i></a>
          </li>
        </div>
        <li>
          <a data-toggle="modal" href="/community-dashboard"><span class="fa fa-users mr-3"></span> Communities</a>
        </li>
        <li>
          <a data-toggle="modal" href="#notificationModal" onclick="markAsRead()"><span id="notification-symbol" class="fa fa-bell mr-3 notif"><small
                class="d-flex align-items-center justify-content-center" id="notification-count"></small></span> Notifications</a>
        </li>
        <li>
          <a data-toggle="modal" href="#accountModal" onclick="fillAccountDetails()"><span
              class="fa fa-cog mr-3"></span> Settings</a>
        </li>
        <li>
          <a href="/contact-us"><span class="fa fa-support mr-3"></span> Support <i
              class="fas fa-external-link-alt"></i></a>
        </li>
        <li>
          <a href="/logout"><span class="fa fa-sign-out mr-3"></span> Sign Out</a>
        </li>
      </ul>

    </nav>

    <div id="content" class="">
      <nav id="topNav" class="topNav" style="z-index: 8; margin-bottom: 0; position: fixed;">
        <div class="container-fluid" style="height: 70px;">
          <div class="custom-menu" style="position: absolute; top: 10px;">
            <button type="button" id="sidebarCollapse" class="btn btn-primary btn-lg"
              style="z-index: 9;color: white;background: transparent;border-radius: unset;padding-right: 2em; border: transparent;">
              <i class="fa fa-bars" aria-hidden="true" style="z-index: 9; font-size: 1.5em;"></i>
            </button>
          </div>
          <div class="navbar-header" style="position: absolute; left: 85px;">
            <h1 class="cursive"><a href="/police-dashboard"><i class="fas fa-star"></i> Fire/EMS Operations</a></h1>
          </div>
        </div>
      </nav>

      <header id="second" style='background-image: url("/static/images/ems-bkground.jpg");'>
        <div class="header-content">
          <div class="inner">
            <h1 class="cursive"><a href="/ems-dashboard">San Andreas - Fire/EMS Operations</a></h1>

            <!-- imports the community specific alerts -->
            <% include community-alerts %>

            <div class="col-lg-10 col-lg-offset-1 text-center">
              <button data-toggle="modal" href="#newCivModal" class="btn btn-primary btn-lg margin-top-2">Add New
                Persona</button>
              <button data-toggle="modal" href="#newVehicleModal" class="btn btn-primary btn-lg margin-top-2">Add New
                Vehicle</button>
              <button data-toggle="modal" href="#searchMedicalRecords" class="btn btn-primary btn-lg margin-top-2">Medical
                Database</button>
              <button data-toggle="modal" href="#10codesModal" class="btn btn-primary btn-lg margin-top-2">10-Codes</button>
              <a href="/map-interactive" class="btn btn-primary btn-lg margin-top-2">Map</a>
            </div>
          </div>
        </div>
      </header>
      <section style='background-image: url("/static/images/blue-clouds.jpg");'>
        <div class="container">

          <!--Table for Personas  -->
          <div class="col-md-12 col-md-offset-0.75">
            <div class="margin-bottom-1">
              <span id="active-bolos margin-right-1" style="font-size: 18px;">Personnel:</span> <button data-toggle="modal"
                href="#newCivModal" class="btn btn-primary btn-md pull-right margin-bottom-1">Add New Persona</button>
            </div>
            <table id="persona-table" class="table table-hover table-bordered">
              <thead>
                <tr>
                  <th>Persona Name</th>
                  <th>Department</th>
                </tr>
              </thead>
              <tbody>
                <% for(var i=0; i<personas.length; i++) {%>
                <tr data-toggle="modal" data-id=<%=i%> data-target="#viewEms" onclick="loadEmsData(<%=i%>)">
                  <td><%= personas[i].ems.firstName%> <%= personas[i].ems.lastName%></td>
                  <td><%= personas[i].ems.department%></td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>

          <!--Table for Vehicles  -->
          <div class="col-md-12 col-md-offset-0.75 margin-top-2">
            <div class="margin-bottom-1">
              <span id="active-bolos" class="margin-right-1" style="font-size: 18px;">Vehicles:</span> <button
                data-toggle="modal" href="#newVehicleModal" class="btn btn-primary btn-md pull-right margin-bottom-1">Add
                New Vehicle</button>
            </div>
            <table id="vehicle-table" class="table table-hover table-bordered">
              <thead>
                <tr>
                  <th>Plate</th>
                  <th>Model</th>
                  <th>Engine #</th>
                </tr>
              </thead>
              <tbody>
                <% for(var i=0; i<vehicles.length; i++) {%>
                <tr class="gray-hover" data-toggle="modal" data-id=<%=i%> data-target="#viewVeh"
                  onclick="loadVehData(<%=i%>)">
                  <td><%= vehicles[i].emsVehicle.plate%></td>
                  <td> <%= vehicles[i].emsVehicle.model%></td>
                  <td> <%= vehicles[i].emsVehicle.engineNumber%></td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
        <div class="container">
          <div id="assigned-call-container" class="col-lg-10 col-lg-offset-1 margin-top-2">
            <!-- active calls -->
            <h4>Assigned Calls: </h4>
            <h5>Click for details</h5>
            <% if (calls !=null && calls.length> 0) { %>
              <% for(var i=0; i<calls.length; i++) { %>
                <% if (calls[i].call.status==true) { %>
                  <% if (calls[i].call.assignedFireEms !=null && calls[i].call.assignedFireEms !='' ) { %>
                    <% for (let j=0; j < vehicles.length; j++) { %>
                      <% if (calls[i].call.assignedFireEms.includes(vehicles[j]._id)) { %>
                        <a id="<%=calls[i]._id%>" data-toggle="modal" href="#callDetailModal"
                          onclick="populateCallDetails('<%=calls[i]._id%>')">
                          <div class="alert alert-success alert-dismissible show" role="alert">
                            Opened: <span id="<%=calls[i]._id%>-createdAt" style="text-transform:capitalize"><time>
                                <%=calls[i].call.createdAtReadable%>
                              </time> | Description:
                              <span id="<%=calls[i]._id%>-description">
                                <%=calls[i].call.shortDescription%>
                              </span>%></span>
                          </div>
                        </a>
                        <% break %>
                      <% } %>
                    <% } %>
                  <% } %>
                <% } %>
              <% } %>
            <% } %>

          </div>
        </div>
      </section>
      <div class="google-ad"></div>
      <% include footer %>
</div>
  </div>
  <div id="galleryModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-body">
          <img src="" id="galleryImage" class="img-responsive" />
          <p>
            <br />
            <button class="btn btn-primary btn-lg center-block" data-dismiss="modal" aria-hidden="true">Close <i
                class="ion-android-close"></i></button>
          </p>
        </div>
      </div>
    </div>
  </div>

  <div id="callDetailModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form id="update-call-form" class="form-horizontal" action="/" method="get">
            <fieldset>

              <!-- Form Name -->
              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Call Details</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="createdBy">Created At:</label>
                <div class="col-md-4">
                  <h5 id="createdAtCallDetail"></h5>
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="createdBy">Updated At:</label>
                <div class="col-md-4">
                  <h5 id="updatedAtCallDetail"></h5>
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="createdBy">Classifier:</label>
                <div class="col-md-4">
                  <h5 id="classifier"></h5>
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="createdBy">Engines:</label>
                <div class="col-md-4">
                  <h5 id="engines"></h5>
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="description">Description:</label>
                <div class="col-md-4">
                  <h5 id="descriptionCallDetail" style="text-transform:capitalize"></h5>
                </div>
              </div>

              <!-- Text Area input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="callNotes">Call Notes:</label>
                <div class="col-md-8 col-md-offset-2">
                  <textarea id="callNotesDetail" name="callNotes" type="text" rows="4" maxlength="500"
                    placeholder="call notes" class="form-control input-md" disabled></textarea>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="newCivModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form class="form-horizontal" action="/create-ems" method="post">
            <fieldset>

              <!-- Form Name -->
              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Add a New Persona</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <!-- Text input-->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="first-name">First Name</label>
                <div class="col-md-4">
                  <input id="first-name" name="emsFirstName" type="text" placeholder="first name"
                    class="form-control input-md" data-trigger="first-name-popover"
                    data-content="* First name cannot contain spaces." required="">
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="last-name">Last Name</label>
                <div class="col-md-4">
                  <input id="last-name" name="emsLastName" type="text" placeholder="last name"
                    class="form-control input-md" data-trigger="last-name-popover"
                    data-content="* Last name cannot contain spaces." required="">
                </div>
              </div>

              <!-- Select Basic -->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="department">Department</label>
                <div class="col-md-4">
                  <select id="department" name="department" class="form-control">
                    <option value="Fire">Fire</option>
                    <option value="EMS">EMS</option>
                  </select>
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="assignment-area">Assignment Area</label>
                <div class="col-md-4">
                  <input id="assignment-area" name="assignmentArea" type="text" placeholder="assignment area"
                    maxlength="50" class="form-control input-md" required>
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="station">Station</label>
                <div class="col-md-4">
                  <input id="station" name="station" type="number" placeholder="station # (optional)" maxlength="5"
                    class="form-control input-md">
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="call-sign">Call Sign</label>
                <div class="col-md-4">
                  <input id="call-sign" name="callSign" type="text" placeholder="call sign (optional)" maxlength="10"
                    class="form-control input-md">
                </div>
              </div>

              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="submit-new-ems"></label>
                <div class="col-md-4">
                  <input type="hidden" name="userID" value="<%= user._id %>">
                  <input type="hidden" id="activeCommunityID" name="activeCommunityID" ,
                    value="<%=user.user.activeCommunity%>">
                  <button id="submit-new-ems" class="btn btn-primary" onclick="createNewEms()">Create</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="newVehicleModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form class="form-horizontal" action="/create-ems-vehicle" method="post">
            <fieldset>

              <!-- Form Name -->
              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Add a New Vehicle</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <!-- Text input-->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="plate">Plate</label>
                <div class="col-md-4">
                  <input id="plate" name="plate" type="text" maxlength="8" placeholder="plate"
                    class="form-control input-md" required="">

                </div>
              </div>

              <!-- Select input-->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="model">Model</label>
                <div class="col-md-4">
                  <select class="form-control" name="model" id="model" required="">
                    <option value="FireTruck">FireTruck</option>
                    <option value="Fire Dept. Vehicle">Fire Dept. Vehicle</option>
                    <option value="Fire Dept. Chief Vehicle">Fire Dept. Chief Vehicle</option>
                    <option value="Ambulance">Ambulance</option>
                    <option value="Medical Dept. Vehicle">Medical Dept. Vehicle</option>
                    <option value="Medical Dept. Cheif Vehicle">Medical Dept. Cheif Vehicle</option>
                    <option value="LifeGaurd Patrol Vehicle">LifeGaurd Patrol Vehicle</option>
                    <option value="LifeGaurd Boat">LifeGaurd Boat</option>
                  </select>
                </div>
              </div>

              <!-- Text input -->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="engineNumber">Engine #</label>
                <div class="col-md-4">
                  <input id="engineNumber" name="engineNumber" type="text" maxlength="10" placeholder="engine #"
                    class="form-control input-md">
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="color">Color</label>
                <div class="col-md-4">
                  <input id="color" name="color" type="text" placeholder="color (optional)"
                    class="form-control input-md">
                </div>
              </div>

              <!-- Search input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="registeredOwner">Registered Owner</label>
                <div class="col-md-4">
                  <select id="registeredOwner" name="registeredOwner" class="form-control">
                    <option value="N/A">N/A</option>
                    <% for(var i=0; i<personas.length; i++) {%>
                    <option value="<%= personas[i].ems.firstName %> <%= personas[i].ems.lastName%>">
                      <%= personas[i].ems.firstName %> <%= personas[i].ems.lastName%></option>
                    <% } %>
                  </select>
                </div>
              </div>

              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="create-vehicle"></label>
                <div class="col-md-4">
                  <input type="hidden" name="userID" value="<%= user._id %>">
                  <input type="hidden" id="activeCommunityID" name="activeCommunityID" ,
                    value="<%=user.user.activeCommunity%>">
                  <button id="create-vehicle" class="btn btn-primary">Create</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="searchMedicalRecords" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div id="personNotFound" class="alert alert-warning" style="display:none">
        <strong>Not Found!</strong> Person not found in medical database.
      </div>
      <div id="firstNameRequired" class="alert alert-warning" style="display:none">
        <strong>First Name is Required!</strong>
      </div>
      <div id="lastNameRequired" class="alert alert-warning" style="display:none">
        <strong>Last Name is Required!</strong>
      </div>
      <div id="dateOfBirthRequired" class="alert alert-warning" style="display:none">
        <strong>Date of Birth is Required!</strong>
      </div>
      <div class="modal-content">
        <div class="modal-body">
          <!-- <form class="form-horizontal" name="findFirearm" action="/medical-search" method="get"> -->
          <fieldset>
            <div class="">
              <!-- Form Name -->
              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Medical Database</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <!-- Text input-->
              <div id="medical-input-area" class="form-group">
                <div class="col-md-12">
                  <div class="col-md-4">
                    <label class="col-md-12 col-md-offset-1 padding-left-0" for="civ-first-name">First Name</label>
                    <input id="civ-first-name" name="firstName" type="text" placeholder="First Name"
                      class="form-control input-md col-md-offset-1" data-trigger="first-name-popover"
                      data-content="* First name cannot contain spaces." required>
                  </div>
                  <div class="col-md-4">
                    <label class="col-md-12 col-md-offset-1 padding-left-0" for="civ-last-name">Last Name</label>
                    <input id="civ-last-name" name="lastName" type="text" placeholder="Last Name"
                      class="form-control input-md col-md-offset-1" data-trigger="last-name-popover"
                      data-content="* Last name cannot contain spaces." required>
                  </div>
                  <% if (user.user.activeCommunity == '' || user.user.activeCommunity == null) { %>
                  <div class="col-md-4">
                    <label class="col-md-12 col-md-offset-1 padding-left-0" for="civ-dob">Date of Birth</label>
                    <input id="civ-dob" name="dateOfBirth" type="date" placeholder="mm/dd/yyyy"
                      class="form-control input-md col-md-offset-1" required="">
                  </div>
                  <% } %>
                  <div class="col-md-4">
                    <br>
                    <input type="hidden" id="activeCommunityID" name="activeCommunityID" ,
                      value="<%=user.user.activeCommunity%>">
                    <button type="submit" class="btn btn-info" onclick="searchMedicalNames()">Search</button>
                  </div>
                </div>
              </div>
            </div>
            <!-- List of Plates -->
            <div id="medicalDetails" class="col-md-12 margin-top-2">
              <div class="panel-group" id="accordion">
                <div></div>
              </div>
            </div>
        </div>
        </fieldset>
        <!-- </form> -->
      </div>
    </div>
  </div>
  </div>

  <div id="viewEms" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form action="/deleteEms" method="POST">
            <fieldset>
              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Details about your Persona</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <div class="col-md-9">
                <label class="col-md-4 control-label margin-bottom-1" for="first-name">First Name:</label>
                <label id="firstNameView" class="col-md-5">FirstName here</label>
              </div>

              <div class="col-md-9">
                <label class="col-md-4 control-label margin-bottom-1" for="last-name">Last Name:</label>
                <label id="lastNameView" class="col-md-5">LastName here</label>
              </div>

              <div class="col-md-9">
                <label class="col-md-4 control-label margin-bottom-1" for="department">Department:</label>
                <label id="departmentView" class="col-md-5">department here</label>
              </div>

              <div class="col-md-9">
                <label class="col-md-4 control-label margin-bottom-1" for="assignment-area">Assignment Area:</label>
                <label id="assignmentAreaView" class="col-md-5">assignment area here</label>
              </div>

              <div class="col-md-9">
                <label class="col-md-4 control-label margin-bottom-1" for="station">Station:</label>
                <label id="stationView" class="col-md-5">station here</label>
              </div>

              <div class="col-md-9">
                <label class="col-md-4 control-label margin-bottom-1" for="call-sign">Call Sign:</label>
                <label id="callSignView" class="col-md-5">call sign here</label>
              </div>

              <div class="col-md-12 text-align-center">
                <button id="removeEms" type="submit" name="removeEms" class="btn btn-danger">Delete Persona</button>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="viewVeh" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">

          <!-- <form action="/updateOrDeleteEmsVeh" method="POST"> -->
            <fieldset>
              <!-- Form Name -->
              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Details about your Vehicle</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <!-- Text input-->
              <div class="col-md-7">
                <label class="col-md-4 margin-bottom-1" for="first-name">Plate:</label>
                <label class="col-md-5" id="plateView">plate here</label>
                <input id="plateVeh" type="text" value="" style="display:none">
              </div>

              <!-- Text input-->
              <div class="col-md-7">
                <label class="col-md-4 margin-bottom-1" for="last-name">Model:</label>
                <label class="col-md-8" id="modelView">model here</label>
                <input id="modelVeh" type="text" value="" style="display:none">
              </div>

              <!-- Text input-->
              <div class="col-md-7">
                <label class="col-md-4 margin-bottom-1" for="engineNumber">Engine #:</label>
                <label class="col-md-8" id="engineNumView">engine number here</label>
                <input id="engineNumVeh" type="text" value="" style="display:none">
              </div>

              <!-- Text input-->
              <div class="col-md-7">
                <label class="col-md-4 margin-bottom-1" for="color">Color:</label>
                <label class="col-md-5" id="colorView">color here</label>
              </div>

              <!-- Text input-->
              <div class="col-md-7">
                <label class="col-md-4 margin-bottom-1" for="ro">RO:</label>
                <label class="col-md-8" id="roView">ro here</label>
                <input id="roVeh" type="text" value="" style="display:none">
              </div>

              <!-- Text input-->
              <div class="col-md-7">
                <label class="col-md-4 margin-bottom-1" for="statusDispatch">Status:</label>
                <label class="col-md-5" id="statusDispatch">status here</label>
              </div>

              <!-- Text input-->
              <div class="col-md-7">
                <label class="col-md-4 margin-bottom-1" for="statusDispatchSetBy">Set By:</label>
                <label class="col-md-8" id="statusDispatchSetBy">status set by here</label>
              </div>

              <div class="col-md-12 text-align-center margin-bottom-1">
                <button name="action" value="update" class="btn btn-primary margin-bottom-1"
                  title="In Service" onclick="updateStatus('10-8')">10-8</button>
                <button name="action" value="update" class="btn btn-primary margin-bottom-1" title="Busy"
                  onclick="updateStatus('10-6')">10-6</button>
                <button name="action" value="update" class="btn btn-primary margin-bottom-1"
                  title="Out of Service" onclick="updateStatus('10-7')">10-7</button>
                <button name="action" value="update" class="btn btn-primary margin-bottom-1"
                  title="Arrived on Scene" onclick="updateStatus('10-23')">10-23</button>
                <button name="action" value="update" class="btn btn-primary margin-bottom-1"
                  title="In Route" onclick="updateStatus('10-97')">10-97</button>
              </div>
              <div class="col-md-12 text-align-center margin-bottom-2">
                <button name="status" value="10-42" class="btn btn-warning btn-md"
                  title="Log out of CAD" onclick="updateStatus('10-42')">10-42</button>
                <button name="action" value="update" class="btn btn-success btn-md" title="Log in to CAD"
                  onclick="updateStatus('10-41')">10-41</button>
              </div>

              <hr style="width: 88%;max-width: 100rem;">

              <div class="col-md-12 text-align-center">
                <input id="vehicle-id" type="hidden" name="vehicleID" value="">
                <button onclick="deleteEmsVeh()" type="submit" name="action" value="delete" class="btn btn-danger">Delete Vehicle</button>
              </div>
            </fieldset>
        </div>
      </div>
    </div>
  </div>

  <div id="createReportModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form class="form-horizontal" action="/create-medical-report" method="post">
            <fieldset>

              <!-- Form Name -->
              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal" aria-hidden="true"
                onclick="createNewCiv()">X</button>
              <h4>Create a New Report</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <h5>Patient Info:</h5>



              <!-- Text input-->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="civilianID">Drivers License #</label>
                <div class="col-md-6">
                  <input id="new-report-civilianID" name="civilianID" type="text"
                    class="form-control input-md disabled-color" required readonly="readonly">
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="firstName">First Name</label>
                <div class="col-md-6">
                  <input id="new-report-firstName" name="firstName" type="text"
                    class="form-control input-md disabled-color" required readonly="readonly">
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="lastName">Last Name</label>
                <div class="col-md-6">
                  <input id="new-report-lastName" name="lastName" type="text"
                    class="form-control input-md disabled-color" required readonly="readonly">
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="dateOfBirth">Date of Birth</label>
                <div class="col-md-6">
                  <input id="new-report-dateOfBirth" name="dateOfBirth" type="date" max="2999-12-31" min="1900-01-01"
                    class="form-control input-md disabled-color" required readonly="readonly">
                </div>
              </div>

              <hr style="width: 88%;max-width: 100rem;">

              <h5>Incident Information:</h5>

              <!-- Text input-->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="reportDate">Date</label>
                <div class="col-md-6">
                  <input id="new-report-reportDate" name="reportDate" type="date" max="2999-12-31" min="1900-01-01"
                    class="form-control input-md" required>
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="reportingEmsID">Fire/EMS ID</label>
                <div class="col-md-6">
                  <input id="new-report-reportingEmsID" name="reportingEmsID" type="text"
                    class="form-control input-md disabled-color" required readonly="readonly">
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="hospitalized">Hospitalized</label>
                <div class="col-md-6">
                  <select id="new-report-hospitalized" name="hospitalized" class="form-control" selected="selected">
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label class="col-md-4 control-label" for="deceased">Deceased</label>
                <div class="col-md-6">
                  <select id="deceased" name="deceased" class="form-control" selected="no">
                    <option value="false" selected>Flase</option>
                    <option value="true">True</option>
                  </select>
                </div>
              </div>

              <!-- Text input-->
              <div class="form-group required">
                <label class="col-md-4 control-label" for="details">Details</label>
                <div class="col-md-10 col-md-offset-1">
                  <textarea id="new-report-details" name="details" type="text" maxlength="500"
                    placeholder="incident details" class="form-control input-md" required></textarea>
                </div>
              </div>

              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="submit-new-civ"></label>
                <div class="col-md-4 text-center">
                  <input type="hidden" name="userID" value="<%= user._id %>">
                  <input type="hidden" id="new-civ-activeCommunityID" name="activeCommunityID" ,
                    value="<%=user.user.activeCommunity%>">
                  <button id="submit-new-civ" class="btn btn-primary" onclick="createNewMedicalReport()">Create</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="communitiesModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <% include community-management %>
        </div>
      </div>
    </div>
  </div>

  <div id="joinCommunityModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form class="form-horizontal" action="/joinEmsCommunity" method="post">
            <fieldset>

              <!-- Form Name -->
              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal" aria-hidden="true"
                onclick="createNewCiv()">X</button>
              <h4>Join an Existing Community</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="communityCode">Community Code:</label>
                <div class="col-md-4">
                  <input id="communityCode" name="communityCode" style="text-transform: uppercase;" type="text"
                    placeholder="Example: YRFGHHP" class="form-control input-md" minlength="7" maxlength="7" required>
                </div>
              </div>

              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="joinCommunity"></label>
                <div class="col-md-4 text-align-center">
                  <button id="joinCommunity" value="<%= user._id %>" name="userID" class="btn btn-primary"
                    onclick="createNewCiv()">Join</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="leaveActiveCommunityModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form class="form-horizontal" action="/leaveEmsActiveCommunity" method="post">
            <fieldset>

              <!-- Form Name -->
              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Leave Active Community</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <p>NOTE: All personas and vehicles that you created in this community will no longer
                show up on your dashboard after you leave.
              </p>
              <p>Are you sure you want to leave this community?</p>

              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="leaveActiveCommunity"></label>
                <div class="col-md-4 text-align-center">
                  <button id="leaveActiveCommunity" value="<%= user._id %>" name="userID"
                    class="btn btn-danger">Leave</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="createCommunityModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <form class="form-horizontal" action="/createEmsCommunity" method="post">
            <fieldset>

              <!-- Form Name -->
              <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
                aria-hidden="true">X</button>
              <h4>Create a New Community</h4>
              <hr style="width: 88%;max-width: 100rem;">

              <!-- Text input-->
              <div class="form-group">
                <label class="col-md-4 control-label" for="communityName">Community Name:</label>
                <div class="col-md-4">
                  <input id="communityName" name="communityName" style="text-transform: capitalize;" type="text"
                    placeholder="Community Name" class="form-control input-md" maxlength="25" required>
                </div>
              </div>

              <!-- Button -->
              <div class="form-group">
                <label class="col-md-4 control-label" for="createCommunity"></label>
                <div class="col-md-4 text-align-center">
                  <button id="createCommunity" value="<%= user._id %>" name="userID"
                    class="btn btn-primary">Create</button>
                </div>
              </div>
            </fieldset>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="communitiesInfoModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <fieldset>
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal" aria-hidden="true"
              onclick="createNewCiv()">X</button>
            <h4>Check out the New Communities Section!</h4>
            <hr style="width: 88%;max-width: 100rem;">
            <a data-toggle="modal" href="#communitiesModal" onclick="dismissCommunitiesInfoModal()"><img
                src="/images/communities-example.png" class="diagonal-arrow float-right"
                alt="communities example screenshot"></a>
            <img src="/static/images/diagonal-arrow-white.png" class="diagonal-arrow"
              alt="diagonal arrow pointing to top right of page">
          </fieldset>
        </div>
      </div>
    </div>
  </div>

  <div id="notificationModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body text-center">
          <fieldset>
            <button class="btn btn-primary btn-md float-right" type="button" data-dismiss="modal"
              aria-hidden="true">X</button>
            <h3>No Notifications :) </h3>
            <h1 class="margin-top-2">🚀</h1>
          </fieldset>
        </div>
      </div>
    </div>
  </div>

  <% include account-management %>
  <% include 10-codes %>
  <% include notepad %>

  <!--scripts loaded here -->
  <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap.min.js"></script>
  <script src="/static/js/bootstrap.min.js"></script>
  <script src="/static/js/jquery.easing.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js"></script>
  <script src="/static/js/wow.js"></script>
  <script src="/static/js/scripts.js"></script>
  <script src="/static/js/main.js"></script>
  <script>if (window.module) module = window.module;</script>
  <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>

</html>

<script type="text/javascript">
  $(function () {
    var socket=io()
    socket.on('updated_ems_status', res => {
      location.reload();
    });
    socket.on('deleted_ems_vehicle', req => {
      location.reload();
    })

    socket.on('created_call', res => {
      var myUser= <%-JSON.stringify(user)%>;
      if (res.call.communityID==myUser.user.activeCommunity) {
        let dbVehicles = <%-JSON.stringify(vehicles)%>
        for (let i=0; i < dbVehicles.length; i++) {
          if (res.call.assignedFireEms.includes(dbVehciles[i]._id)==true) {
            $('#assigned-call-container').append(
              `<a id="${res._id}" data-toggle="modal" href="#callDetailModal" onclick="populateCallDetails('${res._id}')">
                <div class="alert alert-success alert-dismissible show" role="alert">
                  Opened: <span id="${res._id}-createdAt" style="text-transform:capitalize">
                    <time>${res.call.createdAtReadable}</time> |  Description: <span id="${res._id}-description">${res.call.shortDescription}</span></span>
              </div>
              </a>`
            ).fadeTo(1, function () {
              $(this).add();
            })
          }
        }
      }
    })

    socket.on('cleared_call', res => {
      var myUser= <%-JSON.stringify(user)%>;
      if (res.communityID==myUser.user.activeCommunity) {
        $('#'+res.callID+'-row').remove().fadeOut(5, function () {
          $(this).remove();
        })
      }
    })
  })

  $.delete=function (url, data, callback, type) {
    if ($.isFunction(data)) {
      type=type||callback,
        callback=data,
        data={}
    }

    return $.ajax({
      url: url,
      type: 'DELETE',
      success: callback,
      data: data,
      contentType: type
    });
  }

  function populateCallDetails(callID) {
    var socket=io();
    socket.emit('get_call_by_id', callID)
    socket.on('load_call_by_id_result', (res) => {
      //debug log
      //console.log(res)
      var createdDate=new Date(res.call.createdAt)
      if (res.call.updatedAt===""||res.call.updatedAt===undefined||res.call.updatedAt==='undefined') {
        $('#updatedAtCallDetail').empty().text("N/A")
      } else {
        var updatedDate=new Date(res.call.updatedAt)
        $('#updatedAtCallDetail').empty().text(updatedDate.toLocaleString())
      }
      $('#createdAtCallDetail').empty().text(createdDate.toLocaleString())
      $('#descriptionCallDetail').empty().text(res.call.shortDescription)
      $('#callNotesDetail').empty().text(res.call.callNotes)
      let selectedClassifiers = ""
      for (let i=0; i<res.call.classifier.length; i++) {
        selectedClassifiers += res.call.classifier[i] + ", "
      }
      $('#classifier').empty().text(selectedClassifiers)
      let vehicles = <%-JSON.stringify(vehicles)%>
      let assignedFireEms = ""
      for (let i=0; i<res.call.assignedFireEms.length; i++) {
        for (let j=0; j<vehicles.length; j++) {
          if (vehicles[j]._id==res.call.assignedFireEms[i]) {
            assignedFireEms = assignedFireEms + `Engine - ${vehicles[i].emsVehicle.engineNumber} (${vehicles[i].emsVehicle.model}), `
          }
        }
      }
      $('#engines').empty().text(assignedFireEms)
    })
  }

  function loadEmsData(index) {
    var myVar= <%- JSON.stringify(personas)%>;

    var firstName=myVar[index].ems.firstName
    var lastName=myVar[index].ems.lastName
    var department=myVar[index].ems.department
    var assignmentArea=myVar[index].ems.assignmentArea
    var station=myVar[index].ems.station
    var callSign=myVar[index].ems.callSign

    $('#firstNameView').text(firstName)
    $('#lastNameView').text(lastName)
    $('#departmentView').text(department)
    $('#assignmentAreaView').text(assignmentArea)
    $('#stationView').text(station)
    $('#callSignView').text(callSign)
    emsFullName=firstName+' '+lastName
    $('#removeEms').val(emsFullName)
  }

  function deleteEmsVeh() {
    var socket=io()
    myReq={
      vehicleID: $('#vehicle-id').val()
    }
    socket.emit('delete_ems_vehicle', myReq)
  }

  function updateStatus(status) {
    var socket=io();
    var onDuty=null
    var updateDuty=false
    if (status=='10-41') {
      onDuty=true
      updateDuty=true
      status="Online"
    } else if (status=='10-42') {
      onDuty=false
      updateDuty=true
      status="Offline"
    }
    myReq={
      vehicleID: $('#vehicle-id').val(),
      status: status,
      setBy: 'Self',
      onDuty: onDuty,
      updateDuty: updateDuty
    }
    socket.emit('update_ems_status', myReq)
  }

  function loadVehData(index) {
    var myVar= <%- JSON.stringify(vehicles)%>;

    var color=myVar[index].emsVehicle.color
    var plate=myVar[index].emsVehicle.plate.toUpperCase()
    var model=myVar[index].emsVehicle.model
    var engineNumber=myVar[index].emsVehicle.engineNumber
    var registeredOwner=myVar[index].emsVehicle.registeredOwner
    var status=myVar[index].emsVehicle.dispatchStatus
    var statusSetBy=myVar[index].emsVehicle.dispatchStatusSetBy
    // If emsVehicle was created before fire_ems_update
    // This converts the undefined values to blank spaces for UI
    if (statusSetBy==undefined) statusSetBy="";
    if (status==undefined) status="";
    $('#vehicle-id').val(myVar[index]._id)
    $('#plateView').text(plate)
    $('#modelView').text(model)
    $('#engineNumView').text(engineNumber)
    $('#colorView').text(color)
    $('#roView').text(registeredOwner)
    $('#modelVeh').val(model)
    $('#engineNumVeh').val(engineNumber)
    $('#roVeh').val(registeredOwner)
    $('#plateVeh').val(plate)
    $('#statusDispatch').text(status)
    $('#statusDispatchSetBy').text(statusSetBy)
  }

  function createNewEms() {
    $('#first-name').popover('hide')
    $('#last-name').popover('hide')
  }

  function fillAccountDetails() {
    var myUser= <%- JSON.stringify(user)%>;
    $('#accountEmail').val(myUser.user.email)
    $('#accountUsername').val(myUser.user.username)
    $('#accountCallSign').val(myUser.user.callSign)
  }

  function cancelUsername() {
    var myUser= <%- JSON.stringify(user)%>;
    $('#accountUsername').val(myUser.user.username)
    $('#updateUsernameBtns').hide();
  }

  function cancelCallSign() {
    var myUser= <%- JSON.stringify(user)%>;
    $('#accountCallSign').val(myUser.user.callSign)
    $('#updateCallSignBtns').hide();
  }

  function setDateAndTime(dateElement, timeElement) {
    $(dateElement)[0].valueAsDate=new Date();
    $(timeElement)[0].value=new Date().toLocaleTimeString('en-GB', {
      hour: "2-digit",
      minute: "2-digit"
    })
  }

  function CreateReport(firstName, lastName, civilianID, dateOfBirth) {
    var myUser= <%- JSON.stringify(user)%>;
    $('#new-report-civilianID').val(civilianID);
    $('#new-report-firstName').val(firstName);
    $('#new-report-lastName').val(lastName);
    $('#new-report-dateOfBirth').val(dateOfBirth);
    $('#new-report-reportingEmsID').val(myUser._id);
  }

  function pronounceDead(status) {
    if (status) document.getElementById("deceased").value = "yes";
    if (!status) document.getElementById("deceased").value = "no";
  }

  function searchMedicalNames() {
    if (!document.getElementById('civ-first-name').validity.valid) {
      $('#firstNameRequired').show()
      return
    } else {
      $('#firstNameRequired').hide()
    }
    if (!document.getElementById('civ-last-name').validity.valid) {
      $('#lastNameRequired').show()
      return
    } else {
      $('#lastNameRequired').hide()
    }
    if (document.getElementById('civ-dob')!=null) {

      if (!document.getElementById('civ-dob').validity.valid) {
        $('#dateOfBirthRequired').show()
        return
      } else {
        $('#dateOfBirthRequired').hide()
      }
    }
    var myUser= <%- JSON.stringify(user)%>;
    var activeCommunityID
    $("#accordion").empty()
    if (myUser.user.activeCommunity!=""&&myUser.user.activeCommunity!=null) {
      activeCommunityID=myUser.user.activeCommunity
    }
    var parameters={
      firstName: $('#civ-first-name').val(),
      lastName: $('#civ-last-name').val(),
      dateOfBirth: $('#civ-dob').val(),
      activeCommunityID: activeCommunityID
    };
    $.get('/medical-database', parameters, function (data) {
      var i=0
      if (data.civilians.length<1) {
        $('#personNotFound').show()
        return
      }
      $('#personNotFound').hide()
      data.civilians.forEach(function (e) {
        var collapsed
        if (i==0) {
          collapsed="in"
        } else {
          collapsed=""
        }
        var newRowContent
        newRowContent=`
          <!-- List of Civilians -->

                      <div class="panel panel-default background-transparent">
                          <div class="panel-heading" data-toggle="collapse" data-id="`+i+`" data-parent="#accordion" href="#collapse`+i+`"
                            <h4 class="panel-title">
                              <a class="blue-hover capitalize">
                                  `+e.civilian.firstName+` `+e.civilian.lastName+` | `+e._id+`</a>
                            </h4>
                          </div>

                            <div id="collapse`+i+`" class="panel-collapse collapse `+collapsed+`">

                            <div class="panel-body">
                                <div class="text-align-center">
                                  <button data-toggle="modal" href="#createReportModal" class="btn btn-primary btn-md margin-bottom-05" onclick="pronounceDead(false);CreateReport('`+e.civilian.firstName+`', '`+e.civilian.lastName+`', '`+e._id+`', '`+e.civilian.birthday+`');setDateAndTime('#new-report-reportDate', '');">Create Report</button>
                                  <button data-toggle="modal" href="#createReportModal" class="btn btn-primary btn-md margin-bottom-05" onclick="pronounceDead(true);CreateReport('`+e.civilian.firstName+`', '`+e.civilian.lastName+`', '`+e._id+`', '`+e.civilian.birthday+`');setDateAndTime('#new-report-reportDate', '')">Pronounce Dead</button>
                                </div>
                                <hr/>
                                Driver's ID #: `+e._id+`<br/>
                                Date of Birth: `+e.civilian.birthday+`<br/>
                                Address: `+e.civilian.address+`<br/>
                                Occupation: `+e.civilian.occupation+`<br/>
                                Deceased: `+e.civilian.deceased+`<br/>
                                <hr style="width: 88%;max-width: 100rem;">
                                <h4>Medical History</h4>
                                <ul class="nav nav-pills mb-3 margin-bottom-1" id="pills-tab" role="tablist">
                                  <li class="nav-item active">
                                    <a class="nav-link active" id="pills-reports-tab-`+e._id+`" data-toggle="pill" href="#pills-reports-`+e._id+`" role="tab" aria-controls="pills-reports-`+e._id+`" aria-selected="true">Reports</a>
                                  </li>
                                  <li class="nav-item">
                                    <a class="nav-link" id="pills-medications-tab-`+e._id+`" data-toggle="pill" href="#pills-medications-`+e._id+`" role="tab" aria-controls="pills-medications-`+e._id+`" aria-selected="false">Medications</a>
                                  </li>
                                  <li class="nav-item">
                                    <a class="nav-link" id="pills-conditions-tab-`+e._id+`" data-toggle="pill" href="#pills-conditions-`+e._id+`" role="tab" aria-controls="pills-conditions-`+e._id+`" aria-selected="false">Pre-Existing Conditions</a>
                                  </li>
                                </ul>
                                <div class="tab-content" id="pills-tabContent">
                                  <div class="tab-pane fade active in" id="pills-reports-`+e._id+`" role="tabpanel" aria-labelledby="pills-reports-tab-`+e._id+`">
                                    <table id="reports-table-`+e._id+`" class="table" border="1" frame="box">
                                      <thead>
                                        <tr style="background-color: #2d2d2d;"><td>Date<br><i><small>YYYY-M-D</small></i></td><td>Hospitalized<br><i><small>Y/N</small></i></td><td>Summary</td><td>Delete</td></tr>
                                        </thead>
                                        <tbody>
                                          <!-- List of Reports -->
                                          </tbody>
                                      </table>
                                  </div>
                                  <div class="tab-pane fade" id="pills-medications-`+e._id+`" role="tabpanel" aria-labelledby="pills-medications-tab-`+e._id+`">
                                    <table id="medications-table-`+e._id+`" class="table" border="1" frame="box">
                                      <thead>
                                        <tr style="background-color: #2d2d2d;"><td>Start Date<br><i><small>YYYY-M-D</small></i></td><td>Name</td><td>Dosage</td><td>Frequency</td><td>Delete</td></tr>
                                      </thead>
                                      <tbody>
                                        <!-- List of Medications -->
                                        </tbody>
                                    </table>
                                  </div>
                                  <div class="tab-pane fade" id="pills-conditions-`+e._id+`" role="tabpanel" aria-labelledby="pills-conditions-tab-`+e._id+`">
                                    <table id="conditions-table-`+e._id+`" class="table" border="1" frame="box">
                                      <thead>
                                        <tr style="background-color: #2d2d2d;"><td>Date Occurred<br><i><small>YYYY-M-D</small></i></td><td>Name</td><td>Details</td><td>Delete</td></tr>
                                      </thead>
                                      <tbody>
                                        <!-- List of Pre-Existing Conditions -->
                                        </tbody>
                                    </table>
                                  </div>
                                </div>
                            </div>
                          </div>
                        </div>
          `
        $("#accordion").append(newRowContent)
        i++
      });
      //loop through all reports, medications and conditions for this civ
      data.civilians.forEach(function (e) {
        data.reports.forEach(function (r) {
          if (e._id==r.report.civilianID) {
            var newReportContent
            newReportContent=`
            <tr id="`+r._id+`"><td>`+r.report.date+`</td><td style='text-transform: capitalize;'>`+r.report.hospitalized+`</td><td style='text-transform: capitalize;'>`+r.report.details+`</td><td class="text-align-center"><a class='clickable' onclick="deleteReport('`+r._id+`', '`+r.report.civilianID+`')"><i class="glyphicon glyphicon-remove-circle color-alert-red"></i></a></td></tr>
            `
            $("#reports-table-"+r.report.civilianID+" tbody").append(newReportContent)
          }
        });

        data.medications.forEach(function (m) {
          if (e._id==m.medication.civilianID) {
            var newReportContent
            newReportContent=`
            <tr id="`+m._id+`"><td>`+m.medication.startDate+`</td><td style='text-transform: capitalize;'>`+m.medication.name+`</td><td>`+m.medication.dosage+`</td><td style='text-transform: capitalize;'>`+m.medication.frequency+`</td><td class="text-align-center"><a class='clickable' onclick="deleteMedication('`+m._id+`', '`+m.medication.civilianID+`')"><i class="glyphicon glyphicon-remove-circle color-alert-red"></i></a></td></tr>
            `
            $("#medications-table-"+m.medication.civilianID+" tbody").append(newReportContent)
          }
        });

        data.conditions.forEach(function (c) {
          if (e._id==c.condition.civilianID) {
            var newReportContent
            newReportContent=`
            <tr id="`+c._id+`"><td>`+c.condition.dateOccurred+`</td><td style='text-transform: capitalize;'>`+c.condition.name+`</td><td style='text-transform: capitalize;'>`+c.condition.details+`</td><td class="text-align-center"><a class='clickable' onclick="deleteCondition('`+c._id+`', '`+c.condition.civilianID+`')"><i class="glyphicon glyphicon-remove-circle color-alert-red"></i></a></td></tr>
            `
            $("#conditions-table-"+c.condition.civilianID+" tbody").append(newReportContent)
          }
        });

      });
    });
  }

  function deleteReport(id, civilianID) {
    var parameters={ reportID: id };
    $.delete('/reports/'+id, parameters, function (data) {
      $(`table#reports-table-`+civilianID+` tr#`+id).remove()
    })
  }

  function deleteMedication(id, civilianID) {
    var parameters={ medicationID: id };
    $.delete('/medications/'+id, parameters, function (data) {
      $(`table#medications-table-`+civilianID+` tr#`+id).remove()
    })
  }


  function deleteCondition(id, civilianID) {
    var parameters={ conditionID: id };
    $.delete('/conditions/'+id, parameters, function (data) {
      $(`table#conditions-table-`+civilianID+` tr#`+id).remove()
    })
  }

  $("#civ-first-name").keydown(function (event) {
    if (event.keyCode==32) {
      event.preventDefault();
      $('#civ-first-name').popover('show')
    } else {
      $('#civ-first-name').popover('hide')
    }
  });

  $("#civ-last-name").keydown(function (event) {
    if (event.keyCode==32) {
      event.preventDefault();
      $('#civ-last-name').popover('show')
    } else {
      $('#civ-last-name').popover('hide')
    }
  });

  function togglePanicBtnSound() {
    var socket=io();
    socket.emit('update_panic_btn_sound', <%- JSON.stringify(user)%>)
    socket.on('load_panic_btn_result', (res) => {
      $('#panic-button-check-sound').prop("checked", !res.user.panicButtonSound)
      $('#successfully-updated-alert').removeClass('hide').delay(2000).fadeOut(1000, function () {
        $(this).hide();
      });
    })
  }

  $(document).ready(function () {

    $('#persona-table').DataTable({
      "bLengthChange": false,
    })
    $('#vehicle-table').DataTable({
      "bLengthChange": false,
    })

    // displays the Update Username and Cancel buttons for updating the username
    var myUser= <%- JSON.stringify(user)%>;
    $('#accountUsername').on('keyup', function (e) {
      if (e.target.value!=myUser.user.username&&e.target.value!='') {
        $('#updateUsernameBtns').show();
      } else {
        $('#updateUsernameBtns').hide();
      }
    })

    $('#accountCallSign').on('keyup', function (e) {
      if (e.target.value!=myUser.user.callSign&&e.target.value!='') {
        $('#updateCallSignBtns').show();
      } else {
        $('#updateCallSignBtns').hide();
      }
    })

    $('#panic-button-check-sound').prop("checked", myUser.user.panicButtonSound)

    $("#first-name").keydown(function (event) {
      if (event.keyCode==32) {
        event.preventDefault();
        $('#first-name').popover('show')
      } else {
        $('#first-name').popover('hide')
      }
    });
    $("#last-name").keydown(function (event) {
      if (event.keyCode==32) {
        event.preventDefault();
        $('#last-name').popover('show')
      } else {
        $('#last-name').popover('hide')
      }
    });
  });
</script>

<!--  added for google translate -->
<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
}
</script>
